<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Runner vs Attacker - Leaderboard</title>
    <link rel="stylesheet" href="css/game.css">
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: 'Consolas', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        h1 {
            font-size: 48px;
            color: #ffcc00;
            text-shadow: 4px 4px 0 #ff4444;
            margin-bottom: 30px;
        }

        .leaderboard-container {
            width: 80%;
            max-width: 800px;
            background: #222;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        th {
            background-color: #333;
            color: #ffcc00;
            font-size: 18px;
            text-transform: uppercase;
        }

        tr:hover {
            background-color: #2a2a2a;
        }

        .rank-1 {
            color: #ffd700;
            font-weight: bold;
        }

        .rank-2 {
            color: #c0c0c0;
            font-weight: bold;
        }

        .rank-3 {
            color: #cd7f32;
            font-weight: bold;
        }

        .btn-back {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 20px;
            background: #444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .btn-back:hover {
            background: #666;
        }

        #loading {
            text-align: center;
            padding: 20px;
            color: #aaa;
        }
    </style>
</head>

<body>
    <h1>üèÜ GLOBAL LEADERBOARD</h1>

    <div class="leaderboard-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 10%">Rank</th>
                    <th style="width: 40%">Player</th>
                    <th style="width: 25%">Score</th>
                    <th style="width: 25%">Date</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Rows will be populated here -->
            </tbody>
        </table>
        <div id="loading">Loading scores...</div>
    </div>

    <button class="btn-back" onclick="location.href='index.html'">‚¨ÖÔ∏è Back to Menu</button>

    <script>
        const API_URL = window.location.origin + '/api/leaderboard';
        const tbody = document.getElementById('leaderboard-body');
        const loading = document.getElementById('loading');

        async function fetchLeaderboard() {
            try {
                const response = await fetch(API_URL + '?limit=20');
                const data = await response.json();

                loading.style.display = 'none';

                if (data.leaderboard && data.leaderboard.length > 0) {
                    renderLeaderboard(data.leaderboard);
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#777;">No scores yet. Be the first!</td></tr>';
                }
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                loading.textContent = 'Failed to load leaderboard.';
                loading.style.color = '#ff4444';
            }
        }

        function renderLeaderboard(scores) {
            tbody.innerHTML = '';
            scores.forEach((entry, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');

                let rankClass = '';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';

                const date = new Date(entry.timestamp).toLocaleDateString();

                row.innerHTML = `
                    <td class="${rankClass}">#${rank}</td>
                    <td style="font-weight:bold; color:${rankClass ? 'inherit' : '#fff'}">${entry.username}</td>
                    <td style="color:#00c6ff; font-weight:bold;">${entry.score}</td>
                    <td style="color:#777; font-size:14px;">${date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load on start
        fetchLeaderboard();
    </script>
</body>

</html>